{% extends 'base.html' %}
{% block title %}Agenda de Consultas{% endblock %}
{% load static %}  

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/apointments.css' %}">
{% endblock %}

{% block content %}
<div class="container agenda-container">

    <div class="header-section">
        <h1>Agenda de Consultas</h1>

        <a href="{% url 'appointments:appointment_create' %}" class="btn btn-success">
            Nova Consulta
        </a>
    </div>

    {% if appointments %}

        {% regroup appointments by scheduled_date as appointments_by_day %}

        {% for day in appointments_by_day %}

            <div class="agenda-day">
                <h3 class="agenda-day-title">
                    ðŸ“… {{ day.grouper|date:"l" }} â€“ {{ day.grouper|date:"d/m/Y" }}
                </h3>

                {% for appointment in day.list %}
                <div class="agenda-item">

                    <div class="agenda-time">
                        {{ appointment.scheduled_time|time:"H:i" }}
                    </div>

                    <div class="agenda-info">
                        <strong>
                            <a href="{% url 'patients:patient_detail' pk=appointment.patient.pk %}">
                                {{ appointment.patient.user.get_full_name }}
                            </a>
                        </strong><br>
                        Dr(a). {{ appointment.doctor.user.get_full_name }}<br>
                        <span class="agenda-status">{{ appointment.get_status_display }}</span>
                    </div>

                    <div class="agenda-actions">
                        
                        {% if user.is_doctor %}
                            {% if appointment.medical_record %}
                                <a href="{% url 'medical_records:record_detail' pk=appointment.medical_record.pk %}"
                                   class="btn btn-sm btn-info">Ver ProntuÃ¡rio</a>
                                <a href="{% url 'medical_records:record_update' appointment_pk=appointment.pk %}"
                                   class="btn btn-sm btn-warning">Editar ProntuÃ¡rio</a>
                            {% else %}
                                <a href="{% url 'medical_records:record_create' appointment_pk=appointment.pk %}"
                                   class="btn btn-sm btn-primary">Criar ProntuÃ¡rio</a>
                            {% endif %}
                        {% endif %}

                        <a href="{% url 'appointments:appointment_detail' appointment.pk %}" 
                           class="btn btn-sm btn-secondary">Detalhes</a>
                    </div>
                </div>
                {% endfor %}
            </div>

        {% endfor %}

    {% else %}
    <p class="alert alert-warning">Nenhuma consulta encontrada.</p>
    {% endif %}
</div>
{% endblock %}