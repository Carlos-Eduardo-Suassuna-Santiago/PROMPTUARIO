{% extends 'base.html' %}
<<<<<<< HEAD
{% block title %}Agenda de Consultas{% endblock %}
=======
{% load static %}  
{% block title %}Lista de Consultas{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/apointments.css' %}">
{% endblock %}
>>>>>>> reafctor/doctor-pages

{% block content %}
<div class="container agenda-container">

    <div class="header-section">
        <h1>Agenda de Consultas</h1>

        <a href="{% url 'appointments:appointment_create' %}" class="btn btn-primary">
            Nova Consulta
        </a>
    </div>
<<<<<<< HEAD

    {% if appointments %}

        {% regroup appointments by scheduled_date as appointments_by_day %}

        {% for day in appointments_by_day %}

        <div class="agenda-day">
            <h3 class="agenda-day-title">
                ðŸ“… {{ day.grouper|date:"l" }} â€“ {{ day.grouper|date:"d/m/Y" }}
            </h3>

            {% for appointment in day.list %}
            <div class="agenda-item">

                <!-- HorÃ¡rio -->
                <div class="agenda-time">
                    {{ appointment.scheduled_time|time:"H:i" }}
                </div>

                <!-- InformaÃ§Ãµes -->
                <div class="agenda-info">
                    <strong>{{ appointment.patient.user.get_full_name }}</strong><br>
                    Dr(a). {{ appointment.doctor.user.get_full_name }}<br>
                    <span class="agenda-status">{{ appointment.get_status_display }}</span>
                </div>

                <!-- AÃ§Ãµes -->
                <div class="agenda-actions">
=======
    <table class="table">
        <thead>
            <tr>
                <th>Data</th>
                <th>HorÃ¡rio</th>
                <th>Paciente</th>
                {% if user.is_doctor %}
                <th>ProntuÃ¡rio</th> {% endif %}
                <th>MÃ©dico</th>
                <th>Status</th>
                <th>AÃ§Ãµes</th>
            </tr>
        </thead>
        <tbody>
            {% for appointment in appointments %}
            <tr>
                <td>{{ appointment.scheduled_date }}</td>
                <td>{{ appointment.scheduled_time }}</td>
                <td><a href="{% url 'patients:patient_detail' pk=appointment.patient.pk %}">{{ appointment.patient.user.get_full_name }}</a></td>
                
                {% if user.is_doctor %}
                <td>
                    {% if appointment.medical_record %}
                        Dr(a). {{ appointment.medical_record.doctor.user.get_full_name }}
                    {% else %}
                        â€”
                    {% endif %}
                </td>
                {% endif %}

                <td>Dr(a). {{ appointment.doctor.user.get_full_name }}</td>
                
                <td>{{ appointment.get_status_display }}</td>
                
                <td>
>>>>>>> reafctor/doctor-pages
                    {% if user.is_doctor %}
                        {% if appointment.medical_record %}
                            <a href="{% url 'medical_records:record_detail' pk=appointment.medical_record.pk %}"
                               class="btn btn-sm btn-success">Ver ProntuÃ¡rio</a>
                            <a href="{% url 'medical_records:record_update' appointment_pk=appointment.pk %}"
                               class="btn btn-sm btn-warning">Editar</a>
                        {% else %}
                            <a href="{% url 'medical_records:record_create' appointment_pk=appointment.pk %}"
                               class="btn btn-sm btn-primary">Criar ProntuÃ¡rio</a>
                        {% endif %}
                    {% endif %}

                    <a href="{% url 'appointments:appointment_detail' appointment.pk %}" class="btn btn-info">Detalhes</a>
                </div>
            </div>
            {% endfor %}
        </div>

        {% endfor %}

    {% else %}
    <p class="alert alert-warning">Nenhuma consulta encontrada.</p>
    {% endif %}
</div>
{% endblock %}