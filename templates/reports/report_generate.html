{% extends "base.html" %}
{% load static %}

{% block title %}Relatório Gerado{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/reports.css' %}">

<div class="container report-container mt-4 mb-5">

    <!-- Cabeçalho -->
    <div class="report-header text-center mb-4">
        <h2 class="report-title">Relatório Médico</h2>
        <p class="report-subtitle">
            Gerado em: {{ generated_at|date:"d/m/Y H:i" }}
        </p>
    </div>

    {% if error %}
        <div class="alert alert-danger text-center">
            {{ error }}
        </div>
    {% else %}

    <!-- Informações do médico -->
    <div class="report-card">
        <h4 class="section-title">Informações do Médico</h4>

        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <strong>Nome:</strong> {{ doctor.user.get_full_name }}
            </li>
            <li class="list-group-item">
                <strong>Especialidade:</strong> {{ doctor.speciality }}
            </li>
        </ul>
    </div>

    <!-- Estatísticas gerais -->
    <div class="report-card">
        <h4 class="section-title">Estatísticas Gerais</h4>

        <div class="row text-center">
            <div class="col-md-4">
                <div class="stat-box">
                    <span class="stat-value">{{ total_appointments }}</span>
                    <span class="stat-label">Agendamentos Totais</span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-box">
                    <span class="stat-value">{{ completed_appointments }}</span>
                    <span class="stat-label">Concluídos</span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-box">
                    <span class="stat-value">{{ cancelled_appointments }}</span>
                    <span class="stat-label">Cancelados</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Prontuários -->
    <div class="report-card">
        <h4 class="section-title">Prontuários</h4>

        <div class="row text-center">
            <div class="col-md-6">
                <div class="stat-box">
                    <span class="stat-value">{{ total_medical_records }}</span>
                    <span class="stat-label">Prontuários Registrados</span>
                </div>
            </div>

            <div class="col-md-6">
                <div class="stat-box">
                    <span class="stat-value">{{ unique_patients_attended }}</span>
                    <span class="stat-label">Pacientes Atendidos</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Últimos 30 dias -->
    <div class="report-card">
        <h4 class="section-title">Últimos 30 Dias</h4>

        <div class="stat-box text-center">
            <span class="stat-value">{{ recent_appointments_count }}</span>
            <span class="stat-label">Agendamentos Recentes</span>
        </div>
    </div>

    <!-- Diagnósticos -->
    <div class="report-card">
        <h4 class="section-title">Top Diagnósticos</h4>

        {% if top_diagnoses %}
            <table class="table table-hover report-table mt-3">
                <thead>
                    <tr>
                        <th>Diagnóstico</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for diag in top_diagnoses %}
                        <tr>
                            <td>{{ diag.diagnosis }}</td>
                            <td>{{ diag.count }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="text-muted">Nenhum diagnóstico encontrado.</p>
        {% endif %}
    </div>

    <!-- Botões -->
    <div class="text-center mt-4">
        <a href="{% url 'reports:doctor_report' %}" class="btn btn-secondary"> Voltar
        </a>

        <a href="{% url 'reports:report_pdf' %}" class="btn btn-primary"> Baixar PDF
</a>

    </div>

    {% endif %}
</div>

{% endblock %}
