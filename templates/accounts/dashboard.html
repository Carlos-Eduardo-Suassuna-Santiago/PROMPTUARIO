{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Promptuario{% endblock %}

{% block content %}

<div class="icon-links-container">
    <a href="{% url 'appointments:appointment_list' %}" class="icon-link-card">
        <i class="fas fa-stethoscope"></i> <span class="link-text">Exames</span>
    </a>
    <a href="#" class="icon-link-card">
        <i class="fas fa-syringe"></i> <span class="link-text">Vacinas</span>
    </a>
    <a href="#" class="icon-link-card">
        <i class="fas fa-capsules"></i> <span class="link-text">Medicamentos</span>
    </a>
    <a href="#" class="icon-link-card disabled">
        <i class="fas fa-allergies"></i> <span class="link-text">Alergias</span>
    </a>
    <a href="{% url 'appointments:appointment_calendar' %}" class="icon-link-card">
        <i class="fas fa-book-medical"></i> <span class="link-text">Agenda</span>
    </a>
</div>

<div class="dashboard-main-layout">

    <div class="layout-left-card">
        {% if user.is_admin %}
            <div class="card-header">
                <h3>Resumo Administrativo</h3>
            </div>
            <div class="dashboard-grid admin-stats-grid">
                <div class="dashboard-card">
                    <h3>Usuários</h3>
                    <div class="stat">{{ total_users }}</div>
                    <a href="{% url 'accounts:user_list' %}" class="btn btn-primary">Gerenciar</a>
                </div>
                </div>
        {% elif user.is_doctor %}
            <div class="card-header">
                <h3>Visão Geral do Dia</h3>
            </div>
            <p>Seus próximos passos e informações cruciais aparecerão aqui.</p>
            {% elif user.is_patient %}
            <div class="card-header">
                <h3>Minha Próxima Consulta</h3>
            </div>
            {% if upcoming_appointments.first %}
                <p>Médico: Dr(a). {{ upcoming_appointments.first.doctor.user.get_full_name }}</p>
                <p>Data: {{ upcoming_appointments.first.scheduled_date }} às {{ upcoming_appointments.first.scheduled_time }}</p>
            {% else %}
                <p>Nenhuma consulta futura agendada.</p>
                <a href="{% url 'appointments:appointment_create' %}" class="btn btn-success">Agendar Agora</a>
            {% endif %}
        {% endif %}
    </div>

    <div class="layout-right-list">
        {% if user.is_doctor and today_appointments %}
            <div class="card list-mock-card">
                <div class="card-header">
                    <h3>Consultas de Hoje</h3>
                </div>
                <ul class="today-appointments-list">
                    {% for appointment in today_appointments|slice:":4" %} <li>
                        <span>{{ appointment.scheduled_time }}</span>
                        <strong>{{ appointment.patient.user.get_full_name }}</strong>
                        <a href="{% url 'appointments:appointment_detail' appointment.pk %}"> &gt; </a>
                    </li>
                    {% empty %}
                    <li>Nenhuma consulta marcada para hoje.</li>
                    {% endfor %}
                </ul>
                <div class="view-all-link">
                    <a href="{% url 'appointments:appointment_calendar' %}">Ver Agenda Completa</a>
                </div>
            </div>
        {% elif user.is_patient and upcoming_appointments %}
            <div class="card list-mock-card">
                <div class="card-header">
                    <h3>Próximas Consultas</h3>
                </div>
                 <ul class="today-appointments-list">
                    {% for appointment in upcoming_appointments|slice:":4" %}
                    <li>
                        <span>{{ appointment.scheduled_date }}</span>
                        <strong>Dr. {{ appointment.doctor.user.get_full_name }}</strong>
                        <a href="{% url 'appointments:appointment_detail' appointment.pk %}"> &gt; </a>
                    </li>
                    {% endfor %}
                </ul>
                <div class="view-all-link">
                    <a href="{% url 'appointments:appointment_list' %}">Ver Todas</a>
                </div>
            </div>
        {% else %}
             <div class="card list-mock-card">
                <div class="card-header">
                    <h3>Atividades Recentes</h3>
                </div>
                <ul class="today-appointments-list">
                    <li><div class="mock-line short"></div></li>
                    <li><div class="mock-line long"></div></li>
                    <li><div class="mock-line short"></div></li>
                    <li><div class="mock-line long"></div></li>
                </ul>
            </div>
        {% endif %}
    </div>

</div>

{% endblock %}