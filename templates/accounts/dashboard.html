{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
{% endblock %}

{% block title %}Dashboard - Prontuário{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>Bem-vindo, {{ user.get_full_name }}!</h2>
        <p>Tipo de usuário: {{ user.get_user_type_display }}</p>
    </div>

    <div class="card-body">

        {# ======================== ADMIN ======================== #}
        {% if user.is_admin %}
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>Usuários</h3>
                <div class="stat">{{ total_users }}</div>
                <a href="{% url 'accounts:user_list' %}" class="btn btn-primary">Gerenciar</a>
            </div>

            <div class="dashboard-card">
                <h3>Médicos</h3>
                <div class="stat">{{ total_doctors }}</div>
                <a href="{% url 'accounts:doctor_list' %}" class="btn btn-primary">Ver Todos</a>
            </div>

            <div class="dashboard-card">
                <h3>Pacientes</h3>
                <div class="stat">{{ total_patients }}</div>
                <a href="{% url 'patients:patient_list' %}" class="btn btn-primary">Ver Todos</a>
            </div>
        </div>
        {% endif %}

        {# ======================== MÉDICO ======================== #}
        {% if user.is_doctor %}
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>Consultas Hoje</h3>
                <div class="stat">{{ today_appointments.count }}</div>
                <a href="{% url 'accounts:doctor_agenda' %}" class="btn btn-primary">Ver Agenda</a>
            </div>

            <div class="dashboard-card">
                <h3>Prontuários</h3>
                <a href="{% url 'accounts:doctor_records' %}" class="btn btn-primary">Acessar</a>
            </div>

            <div class="dashboard-card">
                <h3>Relatórios</h3>
                <a href="{% url 'accounts:doctor_reports' %}" class="btn btn-primary">Gerar</a>
            </div>
        </div>

        {% if today_appointments %}
        <div class="card mt-4">
            <div class="card-header">
                <h3>Consultas de Hoje</h3>
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>Horário</th>
                        <th>Paciente</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>

                <tbody>
                    {% for appointment in today_appointments %}
                    <tr>
                        <td>{{ appointment.scheduled_time }}</td>
                        <td>{{ appointment.patient.user.get_full_name }}</td>
                        <td>{{ appointment.get_status_display }}</td>
                        <td>
                            <a href="{% url 'appointments:appointment_detail' appointment.pk %}" 
                               class="btn btn-primary">Ver</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>
        {% endif %}
        {% endif %}

        {# ======================== PACIENTE ======================== #}
        {% if user.is_patient %}
        <div class="dashboard-grid">

            <div class="dashboard-card">
                <h3>Minhas Consultas</h3>
                <a href="{% url 'appointments:appointment_list' %}" class="btn btn-primary">Ver Todas</a>
            </div>

            <div class="dashboard-card">
                <h3>Meu Prontuário</h3>
                <a href="{% url 'patients:patient_detail' user.patient_profile.pk %}" 
                   class="btn btn-primary">Acessar</a>
            </div>

            <div class="dashboard-card">
                <h3>Nova Consulta</h3>
                <a href="{% url 'appointments:appointment_create' %}" class="btn btn-success">Agendar</a>
            </div>

        </div>

        {% if upcoming_appointments %}
        <div class="card mt-4">
            <div class="card-header">
                <h3>Próximas Consultas</h3>
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Horário</th>
                        <th>Médico</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>

                <tbody>
                    {% for appointment in upcoming_appointments %}
                    <tr>
                        <td>{{ appointment.scheduled_date }}</td>
                        <td>{{ appointment.scheduled_time }}</td>
                        <td>Dr(a). {{ appointment.doctor.user.get_full_name }}</td>
                        <td>{{ appointment.get_status_display }}</td>
                        <td>
                            <a href="{% url 'appointments:appointment_detail' appointment.pk %}" 
                               class="btn btn-primary">Ver</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>
        {% endif %}
        {% endif %}

        {# ======================== ATENDENTE ======================== #}
        {% if user.is_attendant %}
        <div class="dashboard-grid">

            <div class="dashboard-card">
                <h3>Consultas Pendentes</h3>
                <div class="stat">{{ pending_appointments.count }}</div>
                <a href="{% url 'appointments:appointment_list' %}" class="btn btn-primary">Gerenciar</a>
            </div>

            <div class="dashboard-card">
                <h3>Pacientes</h3>
                <a href="{% url 'patients:patient_list' %}" class="btn btn-primary">Ver Todos</a>
            </div>

            <div class="dashboard-card">
                <h3>Nova Consulta</h3>
                <a href="{% url 'appointments:appointment_create' %}" class="btn btn-success">Agendar</a>
            </div>

        </div>
        {% endif %}

    </div>
</div>
{% endblock %}